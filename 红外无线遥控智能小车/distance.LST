C51 COMPILER V9.54   DISTANCE                                                              05/12/2021 08:58:57 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE DISTANCE
OBJECT MODULE PLACED IN distance.OBJ
COMPILER INVOKED BY: C:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE distance.c COMPACT OPTIMIZE(8,SPEED) BROWSE DEBUG OB
                    -JECTEXTEND TABS(2)

line level    source

   1          #include <reg52.h>
   2          #include <stdio.h>
   3          #include <math.h>
   4          #include "1602.h"
   5          #include "delay.h"
   6          #include "string.h"
   7          #include "MatrixKey.h"
   8          sbit TRIGL = P2 ^ 0;
   9          sbit ECHOL = P2 ^ 1;
  10          sbit TRIGB = P3 ^ 4;
  11          sbit ECHOB = P3 ^ 5;
  12          sbit TRIGR = P3 ^ 6;
  13          sbit ECHOR = P3 ^ 7;
  14          sbit SPK = P2 ^ 2;
  15          
  16          /*------------------------------------------------
  17                     定时器
  18          ------------------------------------------------*/
  19          void TIM1init(void)
  20          {
  21   1      
  22   1        TMOD |= 0x10;
  23   1        TH1 = 0x00;
  24   1        TL1 = 0x00;
  25   1        ET1 = 1;
  26   1        EA = 1;
  27   1      
  28   1      }
  29          /*------------------------------------------------
  30                  主函数
  31          ------------------------------------------------*/
  32           distancet(void);
  33          {
*** ERROR C141 IN LINE 33 OF distance.c: syntax error near '{'
  34          
  35            TIM1init();
*** ERROR C231 IN LINE 35 OF distance.c: 'TIM1init': redefinition
  36            LCD_Init();
*** ERROR C231 IN LINE 36 OF distance.c: 'LCD_Init': redefinition
  37            while (1)
*** ERROR C141 IN LINE 37 OF distance.c: syntax error near 'while'
*** ERROR C141 IN LINE 37 OF distance.c: syntax error near '1'
  38            {
  39          
  40              /*蜂鸣器警戒值输入*/
  41              while (k <= 3)
*** ERROR C141 IN LINE 41 OF distance.c: syntax error near '<=', expected ')'
  42              {
  43                if (k == 0)
*** ERROR C141 IN LINE 43 OF distance.c: syntax error near '==', expected ')'
  44                {
  45                    LCD_Write_String(0, 1, " L___ B___ R___ ");
*** ERROR C141 IN LINE 45 OF distance.c: syntax error near '0'
*** ERROR C231 IN LINE 45 OF distance.c: '_LCD_Write_String': redefinition
C51 COMPILER V9.54   DISTANCE                                                              05/12/2021 08:58:57 PAGE 2   

  46                }
*** ERROR C141 IN LINE 46 OF distance.c: syntax error near '}'
  47                LCD_Write_String(0, 0, "   input dist   ");
*** ERROR C141 IN LINE 47 OF distance.c: syntax error near '0'
*** ERROR C231 IN LINE 47 OF distance.c: '_LCD_Write_String': redefinition
  48                KeyNum = MatrixKey();
  49                if (KeyNum == 13)
*** ERROR C141 IN LINE 49 OF distance.c: syntax error near 'if'
*** ERROR C141 IN LINE 49 OF distance.c: syntax error near '==', expected ')'
  50                {
  51                  k++;
*** ERROR C129 IN LINE 51 OF distance.c: missing ';' before '++'
  52                  if (k == 1)
  53                  {
  54                    for (i = 2; i < 5;)
  55                    {
  56                      KeyNum = MatrixKey();
  57                      if(i==2)
  58                      {
  59                      if(KeyNum>0&&KeyNum<10)
  60                      {
  61                      leftnumber+=(KeyNum*100);
  62                      }
  63                      }
  64                      if(i==3)
  65                      {
  66                      if(KeyNum>0&&KeyNum<10)
  67                      {
  68                      leftnumber+=(KeyNum*10);
  69                      }
  70                      }
  71                      if(i==4)
  72                      {
  73                      if(KeyNum>0&&KeyNum<10)
  74                      {
  75                      leftnumber+=(KeyNum);
  76                      }
  77                      }
  78                      if (KeyNum < 10)
  79                      {
  80                        
  81                        LCD_Write_Char(i, 1, studentid[KeyNum]);
  82                        i++;
  83                      }
  84                      DelayMs(50);
  85                  
  86                    }
  87                  }
  88                  if (k == 2)
  89                  {
  90                    for (i = 7; i < 10; )
  91                    {
  92                      KeyNum = MatrixKey();
  93                      if(i==7)
  94                      {
  95                      if(KeyNum>0&&KeyNum<10)
  96                      {
  97                      backnumber+=(KeyNum*100);
  98                      }
  99                      }
 100                      if(i==8)
 101                      {
C51 COMPILER V9.54   DISTANCE                                                              05/12/2021 08:58:57 PAGE 3   

 102                      if(KeyNum>0&&KeyNum<10)
 103                      {
 104                      backnumber+=(KeyNum*10);
 105                      }
 106                      }
 107                      if(i==9)
 108                      {
 109                      if(KeyNum>0&&KeyNum<10)
 110                      {
 111                      backnumber+=(KeyNum);
 112                      }
 113                      }
 114                      if (KeyNum < 10)
 115                      {
 116                        LCD_Write_Char(i, 1, studentid[KeyNum]);
 117                        i++;
 118                      }
 119                      DelayMs(50);
 120                    }
 121                  }
 122                  if (k == 3)
 123                  {
 124                    k=4;
 125                    for (i = 12; i < 15; )
 126                    {
 127                      KeyNum = MatrixKey();
 128                      if(i==12)
 129                      {
 130                      if(KeyNum>0&&KeyNum<10)
 131                      {
 132                      rightnumber+=(KeyNum*100);
 133                      }
 134                      }
 135                      if(i==13)
 136                      {
 137                      if(KeyNum>0&&KeyNum<10)
 138                      {
 139                      rightnumber+=(KeyNum*10);
 140                      }
 141                      }
 142                      if(i==14)
 143                      {
 144                      if(KeyNum>0&&KeyNum<10)
 145                      {
 146                      rightnumber+=(KeyNum);
 147                      }
 148                      }
 149                      if (KeyNum < 10)
 150                      {
 151                        LCD_Write_Char(i, 1, studentid[KeyNum]);
 152                        i++;
 153                      }
 154                      DelayMs(50);
 155                    }
 156          
 157                    LCD_Write_String(0, 0, "                ");
 158                  }
 159                }
 160              }
 161            
 162              
 163              /*------------------------------------------------
C51 COMPILER V9.54   DISTANCE                                                              05/12/2021 08:58:57 PAGE 4   

 164                      右方
 165              ------------------------------------------------*/
 166              if (1)
 167              {
 168                /*one*/
 169                TRIGR = 1;
 170                DelayUs2x(10);
 171                TRIGR = 0;
 172                while (!ECHOR);
 173                TR1 = 1;
 174                while (ECHOR);
 175                TR1 = 0;
 176                S = TH1 * 256 + TL1;
 177                S = S / 58;
 178                arr[0] = S;
 179                TH1 = 0;
 180                TL1 = 0;
 181                /*two*/
 182                TRIGR = 1;
 183                DelayUs2x(10);
 184                TRIGR = 0;
 185                while (!ECHOR);
 186                TR1 = 1;
 187                while (ECHOR);
 188                TR1 = 0;
 189                S = TH1 * 256 + TL1;
 190                S = S / 58;
 191                arr[1] = S;
 192                TH1 = 0;
 193                TL1 = 0;
 194                /*third*/
 195                TRIGR = 1;
 196                DelayUs2x(10);
 197                TRIGR = 0;
 198                while (!ECHOR);
 199                TR1 = 1;
 200                while (ECHOR);
 201                TR1 = 0;
 202                S = TH1 * 256 + TL1;
 203                S = S / 58;
 204                arr[2] = S;
 205                TH1 = 0;
 206                TL1 = 0;
 207                /*four*/
 208                TRIGR = 1;
 209                DelayUs2x(10);
 210                TRIGR = 0;
 211                while (!ECHOR);
 212                TR1 = 1;
 213                while (ECHOR);
 214                TR1 = 0;
 215                S = TH1 * 256 + TL1;
 216                S = S / 58;
 217                arr[3] = S;
 218                TH1 = 0;
 219                TL1 = 0;
 220                /*five*/
 221                TRIGR = 1;
 222                DelayUs2x(10);
 223                TRIGR = 0;
 224                while (!ECHOR);
 225                TR1 = 1;
C51 COMPILER V9.54   DISTANCE                                                              05/12/2021 08:58:57 PAGE 5   

 226                while (ECHOR);
 227                TR1 = 0;
 228                S = TH1 * 256 + TL1;
 229                S = S / 58;
 230                arr[4] = S;
 231                TH1 = 0;
 232                TL1 = 0;
 233                /*try*/
 234          
 235                for (i = 0; i < 5 - 1; i++)
 236                  for (j = 0; j < 5 - 1 - i; j++)
 237                    if (arr[j] > arr[j + 1])
 238                    {
 239                      temp = arr[j];
 240                      arr[j] = arr[j + 1];
 241                      arr[j + 1] = temp;
 242                    }
 243                /*try*/
 244                S = ((arr[1] + arr[2] + arr[3] + arr[4] / 4);
 245                temp=rightnumber;
 246                if (S < temp)
 247                {
 248          
 249                SPK = 0;//防止一直给喇叭通电造成损坏
 250                DelayMs(250);
 251          
 252                }
 253                SPK = 1;
 254                sprintf(DisTempData, "R=%6.2f",S);
 255                LCD_Write_String(0, 1, DisTempData);
 256              }
 257              /*------------------------------------------------
 258                    左方
 259              ------------------------------------------------*/
 260              if (1)
 261              {
 262                /*one*/
 263                TRIGL = 1;
 264                DelayUs2x(10);
 265                TRIGL = 0;
 266                while (!ECHOL);
 267                TR1 = 1;
 268                while (ECHOL);
 269                TR1 = 0;
 270                S = TH1 * 256 + TL1;
 271                S = S / 58;       //     58    ,  Y =(X *344)/2
 272                arr[0] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 273                TH1 = 0;
 274                TL1 = 0;
 275                /*two*/
 276                TRIGL = 1;
 277                DelayUs2x(10);
 278                TRIGL = 0;
 279                while (!ECHOL);
 280                TR1 = 1;
 281                while (ECHOL);
 282                TR1 = 0;
 283                S = TH1 * 256 + TL1;
 284                S = S / 58;       //     58    ,  Y =(X *344)/2
 285                arr[1] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 286                TH1 = 0;
 287                TL1 = 0;
C51 COMPILER V9.54   DISTANCE                                                              05/12/2021 08:58:57 PAGE 6   

 288                /*third*/
 289                TRIGL = 1;
 290                DelayUs2x(10);
 291                TRIGL = 0;
 292                while (!ECHOL);
 293                TR1 = 1;
 294                while (ECHOL);
 295                TR1 = 0;
 296                S = TH1 * 256 + TL1;
 297                S = S / 58;
 298                arr[2] = S;
 299                TH1 = 0;
 300                TL1 = 0;
 301                /*four*/
 302                TRIGL = 1;
 303                DelayUs2x(10);
 304                TRIGL = 0;
 305                while (!ECHOL);
 306                TR1 = 1;
 307                while (ECHOL);
 308                TR1 = 0;
 309                S = TH1 * 256 + TL1;
 310                S = S / 58;
 311                arr[3] = S;
 312                TH1 = 0;
 313                TL1 = 0;
 314                /*five*/
 315                TRIGL = 1;
 316                DelayUs2x(10);
 317                TRIGL = 0;
 318                while (!ECHOL);
 319                TR1 = 1;
 320                while (ECHOL);
 321                TR1 = 0;
 322                S = TH1 * 256 + TL1;
 323                S = S / 58;
 324                arr[4] = S;
 325                TH1 = 0;
 326                TL1 = 0;
 327                /*try*/
 328                for (i = 0; i < 10 - 1; i++)
 329                  for (j = 0; j < 10 - 1 - i; j++)
 330                    if (arr[j] > arr[j + 1])
 331                    {
 332                      temp = arr[j];
 333                      arr[j] = arr[j + 1];
 334                      arr[j + 1] = temp;
 335                    }
 336                /*try*/
 337                S = ((arr[1] + arr[2] + arr[3] + arr[4] ) / 4);
 338                temp=leftnumber;
 339                if (S < temp)
 340                {
 341                  
 342                SPK = 0;//防止一直给喇叭通电造成损坏
 343                DelayMs(250);
 344                  
 345                }
 346                SPK = 1;
 347                sprintf(DisTempData,"L=%6.2f", S);
 348                LCD_Write_String(8, 1, DisTempData);
 349              }
C51 COMPILER V9.54   DISTANCE                                                              05/12/2021 08:58:57 PAGE 7   

 350              /*------------------------------------------------
 351                      后方
 352              ------------------------------------------------*/
 353              if (1)
 354              {
 355                TRIGB = 1;
 356                DelayUs2x(10);
 357                TRIGB = 0;
 358                while (!ECHOB);
 359                TR1 = 1;
 360                while (ECHOB);
 361                TR1 = 0;
 362                S = TH1 * 256 + TL1;
 363                S = S / 58;       //     58    ,  Y =(X *344)/2
 364                arr[0] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 365                TH1 = 0;
 366                TL1 = 0;
 367                /*two*/
 368                TRIGB = 1;
 369                DelayUs2x(10);
 370                TRIGB = 0;
 371                while (!ECHOB);
 372                TR1 = 1;
 373                while (ECHOB);
 374                TR1 = 0;
 375                S = TH1 * 256 + TL1;
 376                S = S / 58;       //     58    ,  Y =(X *344)/2
 377                arr[1] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 378                TH1 = 0;
 379                TL1 = 0;
 380                /*third*/
 381                TRIGB = 1;
 382                DelayUs2x(10);
 383                TRIGB = 0;
 384                while (!ECHOB);
 385                TR1 = 1;
 386                while (ECHOB);
 387                TR1 = 0;
 388                S = TH1 * 256 + TL1;
 389                S = S / 58;       //     58    ,  Y =(X *344)/2
 390                arr[2] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 391                TH1 = 0;
 392                TL1 = 0;
 393                /*four*/
 394                TRIGB = 1;
 395                DelayUs2x(10);
 396                TRIGB = 0;
 397                while (!ECHOB);
 398                TR1 = 1;
 399                while (ECHOB);
 400                TR1 = 0;
 401                S = TH1 * 256 + TL1;
 402                S = S / 58;       //     58    ,  Y =(X *344)/2
 403                arr[3] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 404                TH1 = 0;
 405                TL1 = 0;
 406                /*five*/
 407                TRIGB = 1;
 408                DelayUs2x(10);
 409                TRIGB = 0;
 410                while (!ECHOB);
 411                TR1 = 1;
C51 COMPILER V9.54   DISTANCE                                                              05/12/2021 08:58:57 PAGE 8   

 412                while (ECHOB);
 413                TR1 = 0;
 414                S = TH1 * 256 + TL1;
 415                S = S / 58;       //     58    ,  Y =(X *344)/2
 416                arr[4] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 417                TH1 = 0;
 418                TL1 = 0;
 419                /*try*/
 420                for (i = 0; i < 10 - 1; i++)
 421                  for (j = 0; j < 10 - 1 - i; j++)
 422                    if (arr[j] > arr[j + 1])
 423                    {
 424                      temp = arr[j];
 425                      arr[j] = arr[j + 1];
 426                      arr[j + 1] = temp;
 427                    }
 428                /*try*/
 429                S = (arr[1] + arr[2] + arr[3] + arr[4]  /4);
 430                temp=backnumber;
 431                if (S < temp)
 432                {
 433                  
 434                SPK = 0;//防止一直给喇叭通电造成损坏
 435                DelayMs(250);
 436                  
 437                }
 438                SPK = 1;
 439                sprintf(DisTempData, "B=%6.2f", S);
 440                LCD_Write_String(4, 0, DisTempData);
 441          
 442              }
 443            }
 444          }
 445          
 446          /*------------------------------------------------
 447                   中断
 448          ------------------------------------------------*/
 449          void Timer0_isr(void) interrupt 2
 450          {
 451            ECHOL = 0;
 452            ECHOB = 0;
 453            ECHOR = 0;
 454          }

C51 COMPILATION COMPLETE.  0 WARNING(S),  15 ERROR(S)
