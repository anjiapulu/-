C51 COMPILER V9.54   MAIN                                                                  05/08/2021 09:46:35 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE main.c COMPACT OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECT
                    -EXTEND TABS(2)

line level    source

   1          /*********************************************************************************
   2          * дʱ䡿 20201212
   3          *     ߡ :03
   4          *      1.0
   5          *     վ http://www.QXMBOT.com/ 
   6          * Ա̡ http://qxmcu.taobao.com/ (ֱ)
   7          * ʵƽ̨ QX-A11ǿС  STC89C52
   8          * ⲿ񡿣 11.0592mhz 
   9          * оƬ STC89C52
  10          * 뻷 Keil Visio4
  11          * ȨУؾ
  12          * Copyright(C) QXMBOT
  13          * All rights reserved
  14          ***********************************************************************************
  15          * ˵οͼ˵
  16          ѿԴṩ
  17          עҪûġ*ײװָϡ 
  18          ֻοʵЧܻҪûе                                
  19          **********************************************************************************/
  20          
  21          /*P32˿ڲܽӶŰߣ޷ң*/
  22          
  23          #include <reg52.h> //51ͷļ
  24          #include <QX_A11.h>//QX-A51Сļ
  25          #include <stdio.h>
  26          #include <math.h>
  27          #include "1602.h"
  28          #include "distance.h"
  29          #include "delay.h"
  30          /*====================================
  31           Զ
  32          ====================================*/
  33          typedef unsigned char INT8U;
  34          typedef unsigned char uchar;
  35          
  36          typedef unsigned int INT16U;
  37          typedef unsigned int uint;
  38          /*====================================
  39          void Delay_Ms(INT16U ms)
  40          msʱβ
  41          12T 51ƬӦʱӺ뼶ʱ
  42          ====================================*/
  43          void Delay_Ms(unsigned int ms)
  44          {
  45   1           unsigned int i;
  46   1         do{
  47   2              i = MAIN_Fosc / 96000; 
  48   2            while(--i);   //96T per loop
  49   2           }while(--ms);
  50   1      }
  51          /*====================================
  52           Ӳӿλ
  53          ====================================*/
  54          sbit IR  = P3^2;     //ݽӿ ⲿжO
C51 COMPILER V9.54   MAIN                                                                  05/08/2021 09:46:35 PAGE 2   

  55          
  56          uchar IRtime;     //ߵƽʱ䣨
  57          uchar IRcord[4];    //ڴ4ֽڵݣû2ֽ+ֵ2ֽڣ
  58          uchar IRdata[33];   //ڴ33λݣһλΪû16+ֵ16
  59          bit IRpro_ok, IRok;  //һں4ֽϡIRokΪ
  60          
  61          void init()    //ʼʱ0 ⲿж0
  62          {
  63   1        TMOD = 0x02; //ʱ0ʽ28λԶװ
  64   1        TH0 = 0x00;  //8λװ0ôʱһεʱ256
  65   1        TL0 = 0x00;
  66   1        EA = 1;      //ж
  67   1        ET0 = 1;     //ʱ0ж
  68   1        TR0 = 1;     //ʱ0
  69   1        IT0 = 1;     //ⲿж0Ϊشʽһ½شһ
  70   1        EX0 = 1;     //ⲿж0
  71   1      }
  72          
  73          void time0() interrupt 1   //嶨ʱ0
  74          {
  75   1        IRtime++;          //1Ϊ278us
  76   1      }
  77          
  78          void int0() interrupt 0       //ⲿж0
  79          {
  80   1        static uchar i;       //  ̬ڻִеʱ򲻻ᶪʧֵiڰ33θߵƽĳʱ
             -IRdata
  81   1        static bit startflag;   //ʼ־λ
  82   1        if(startflag)       //ʼ
  83   1        {
  84   2          if( (IRtime < 53) && (IRtime >= 32) ) /*жǷ룬׵ƽ9000us+4500us 
  85   2          Լ11.0592NECЭ8000-10000+4000-5000 
  86   2          Ѿôiᱻ0ͻῪʼδ*/
  87   2            i = 0;         //ôִi=0浽IRdataĵһλ
  88   2          IRdata[i] = IRtime;      //T0ʱ浽浽ж
  89   2          IRtime = 0;        //㣬һ½صʱڴ
  90   2          i++;           //Ĵ
  91   2          if(i == 33)          //34 ±Ǵ0ʼi33ʾִ34
  92   2          {
  93   3            IRok = 1;        //ôʾ
  94   3            i = 0;         //׼´δ
  95   3          }
  96   2        }
  97   1        else      
  98   1        {
  99   2          IRtime = 0;          //뿪ʼ㿪ʼ
 100   2          startflag = 1;       //ʼ־λ1
 101   2        }
 102   1      }
 103          
 104          void IRcordpro()           //ȡ33ݽ
 105          {
 106   1        uchar i, j, k, cord, value; /*iڴ4ֽڣjڴһֽÿһλk33еһλ
 107   1        cordȡʱжǷ1ʱ*/
 108   1        k = 1;            //ӵһλʼȡ
 109   1        for(i = 0; i < 4; i++)
 110   1        {
 111   2          for(j = 0; j < 8; j++)
 112   2          {
 113   3            cord = IRdata[k];     //cord
 114   3            if(cord > 5)      //11.0592t0ΪԼ278us*5=1390ôжΪ1
 115   3            value = value | 0x80; /*յʱȽλ
C51 COMPILER V9.54   MAIN                                                                  05/08/2021 09:46:35 PAGE 3   

 116   3            λȷŵvalueλں0x08λһ
 117   3            ıvaluaλֵֻλΪ1*/
 118   3            if(j < 7)
 119   3            {
 120   4              value = value >> 1; //valueλν8λݡ
 121   4            }
 122   3            k++;        //ÿִһλ1
 123   3          }
 124   2          IRcord[i] = value;     //ÿһֽڰIRcordС
 125   2          value = 0;         //value´ڴ
 126   2        }
 127   1        IRpro_ok = 1;          //4ֽںIRpro ok1ʾ 
 128   1      }
 129          /*PWMʹ Сǰ*/
 130          void forward()
 131          {
 132   1        left_motor_go; //ǰ
 133   1        right_motor_go; //ҵǰ
 134   1      }
 135          
 136            
 137          /*PWMʹ С*/
 138          void backward()
 139          {
 140   1        left_motor_back; //
 141   1        right_motor_back; //ҵ  
 142   1      }
 143          
 144          
 145          /*PWMʹ Сת*/
 146          void left_run()
 147          {
 148   1        left_motor_stops; //ֹͣ
 149   1        right_motor_go; //ҵǰ  
 150   1      }
 151          
 152          
 153          /*PWMʹ Сת*/
 154          void right_run()
 155          {
 156   1        right_motor_stops;//ҵֹͣ
 157   1        left_motor_go;    //ǰ
 158   1      }
 159          
 160          
 161          /*Сֹͣ*/
 162          void stop()
 163          {
 164   1        right_motor_stops;//ҵֹͣ
 165   1        left_motor_stops; //ֹͣ  
 166   1      }
 167          
 168          void main()
 169          {
 170   1        init(); //ִгʼʱ0ⲿж0
 171   1        TIM1init();    //??????0
 172   1        LCD_Init();    //???LCD
 173   1        Left_moto_pwm = Right_moto_pwm = 1;//ʹҵ
 174   1        while(1)  //ѭ
 175   1        {
 176   2          if(IRok)    //жǷ                    
 177   2          {   
C51 COMPILER V9.54   MAIN                                                                  05/08/2021 09:46:35 PAGE 4   

 178   3            IRcordpro();//4ֽڵ
 179   3            IRok = 0; //µȴ
 180   3            if(IRpro_ok) //жǷ  
 181   3            {
 182   4                  switch(IRcord[2])
 183   4                {
 184   5                   case 0x18:  stop(); Delay_Ms(200); forward();       //ǰ
 185   5                           break;
 186   5                   case 0x52:  stop(); Delay_Ms(200); backward();        //  
 187   5                           break;
 188   5                   case 0x08:  stop(); Delay_Ms(200); left_run();        //ת
 189   5                           break;
 190   5                 case 0x5A:  stop(); Delay_Ms(200); right_run();       //ת
 191   5                           break;
 192   5                 case 0x1C:  stop();           //ֹͣ
 193   5                           break;
 194   5                 default:break;
 195   5                }
 196   4              IRpro_ok = 0;
 197   4            }
 198   3          } 
 199   2          distancet();
 200   2      
 201   2        }
 202   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    331    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =     39    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
