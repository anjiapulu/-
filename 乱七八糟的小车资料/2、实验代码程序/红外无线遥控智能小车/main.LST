C51 COMPILER V9.00   MAIN                                                                  12/22/2020 21:04:42 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*********************************************************************************
   2          * дʱ䡿 20201212
   3          *     ߡ :03
   4          *      1.0
   5          *     վ http://www.QXMBOT.com/ 
   6          * Ա̡ http://qxmcu.taobao.com/ (ֱ)
   7          * ʵƽ̨ QX-A11ǿС  STC89C52
   8          * ⲿ񡿣 11.0592mhz     
   9          * оƬ STC89C52
  10          * 뻷 Keil Visio4
  11          *       ȨУؾ
  12          *       Copyright(C) QXMBOT
  13          *       All rights reserved
  14          ***********************************************************************************
  15          * ˵οͼ˵
  16          ѿԴṩ
  17          עҪûġ*ײװָϡ       
  18          ֻοʵЧܻҪûе                                                                
  19          **********************************************************************************/
  20          
  21          /*P32˿ڲܽӶŰߣ޷ң*/
  22          
  23          #include <reg52.h> //51ͷļ
  24          #include <QX_A11.h>//QX-A51Сļ
  25          
  26          /*====================================
  27           Զ
  28          ====================================*/
  29          typedef unsigned char INT8U;
  30          typedef unsigned char uchar;
  31          
  32          typedef unsigned int INT16U;
  33          typedef unsigned int uint;
  34          /*====================================
  35          void Delay_Ms(INT16U ms)
  36          msʱβ
  37          12T 51ƬӦʱӺ뼶ʱ
  38          ====================================*/
  39          void Delay_Ms(unsigned int ms)
  40          {
  41   1           unsigned int i;
  42   1               do{
  43   2                    i = MAIN_Fosc / 96000; 
  44   2                        while(--i);   //96T per loop
  45   2           }while(--ms);
  46   1      }
  47          /*====================================
  48           Ӳӿλ
  49          ====================================*/
  50          sbit IR  = P3^2;     //ݽӿ     ⲿжO
  51          
  52          uchar IRtime;           //ߵƽʱ䣨
  53          uchar IRcord[4];    //ڴ4ֽڵݣû2ֽ+ֵ2ֽڣ
  54          uchar IRdata[33];   //ڴ33λݣһλΪû16+ֵ16
  55          bit IRpro_ok, IRok;  //һں4ֽϡIRokΪ
C51 COMPILER V9.00   MAIN                                                                  12/22/2020 21:04:42 PAGE 2   

  56          
  57          void init()        //ʼʱ0 ⲿж0
  58          {
  59   1              TMOD = 0x02; //ʱ0ʽ28λԶװ
  60   1              TH0 = 0x00;  //8λװ0ôʱһεʱ256
  61   1              TL0 = 0x00;
  62   1              EA = 1;      //ж
  63   1              ET0 = 1;           //ʱ0ж
  64   1              TR0 = 1;     //ʱ0
  65   1      
  66   1              IT0 = 1;           //ⲿж0Ϊشʽһ½شһ
  67   1              EX0 = 1;           //ⲿж0
  68   1      }
  69          
  70          void time0() interrupt 1   //嶨ʱ0
  71          {
  72   1              IRtime++;                          //1Ϊ278us
  73   1      }
  74          
  75          void int0() interrupt 0                 //ⲿж0
  76          {
  77   1              static uchar i;                         //      ̬ڻִеʱ򲻻ᶪʧֵiڰ33θߵƽĳʱ
             -IRdata
  78   1              static bit startflag;           //ʼ־λ
  79   1              if(startflag)                           //ʼ
  80   1              {
  81   2                      if( (IRtime < 53) && (IRtime >= 32) ) /*жǷ룬׵ƽ9000us+4500us 
  82   2                      Լ11.0592NECЭ8000-10000+4000-5000 
  83   2                      Ѿôiᱻ0ͻῪʼδ*/
  84   2                              i = 0;                           //ôִi=0浽IRdataĵһλ
  85   2                      IRdata[i] = IRtime;              //T0ʱ浽浽ж
  86   2                      IRtime = 0;                              //㣬һ½صʱڴ
  87   2                      i++;                                     //Ĵ
  88   2                      if(i == 33)                              //34 ±Ǵ0ʼi33ʾִ34
  89   2                      {
  90   3                              IRok = 1;                                //ôʾ
  91   3                              i = 0;                           //׼´δ
  92   3                      }
  93   2              }
  94   1              else              
  95   1              {
  96   2                      IRtime = 0;                              //뿪ʼ㿪ʼ
  97   2                      startflag = 1;                   //ʼ־λ1
  98   2              }
  99   1      }
 100          
 101          void IRcordpro()                                 //ȡ33ݽ
 102          {
 103   1              uchar i, j, k, cord, value;     /*iڴ4ֽڣjڴһֽÿһλk33еһλ
 104   1              cordȡʱжǷ1ʱ*/
 105   1              k = 1;                                          //ӵһλʼȡ
 106   1              for(i = 0; i < 4; i++)
 107   1              {
 108   2                      for(j = 0; j < 8; j++)
 109   2                      {
 110   3                              cord = IRdata[k];           //cord
 111   3                              if(cord > 5)                    //11.0592t0ΪԼ278us*5=1390ôжΪ1
 112   3                              value = value | 0x80;   /*յʱȽλ
 113   3                              λȷŵvalueλں0x08λһ
 114   3                              ıvaluaλֵֻλΪ1*/
 115   3                              if(j < 7)
 116   3                              {
C51 COMPILER V9.00   MAIN                                                                  12/22/2020 21:04:42 PAGE 3   

 117   4                                      value = value >> 1;     //valueλν8λݡ
 118   4                              }
 119   3                              k++;                            //ÿִһλ1
 120   3                      }
 121   2                      IRcord[i] = value;         //ÿһֽڰIRcordС
 122   2                      value = 0;                         //value´ڴ
 123   2              }
 124   1              IRpro_ok = 1;                              //4ֽںIRpro ok1ʾ 
 125   1      }
 126          /*PWMʹ Сǰ*/
 127          void forward()
 128          {
 129   1              left_motor_go; //ǰ
 130   1              right_motor_go; //ҵǰ
 131   1      }
 132          
 133                  
 134          /*PWMʹ С*/
 135          void backward()
 136          {
 137   1              left_motor_back; //
 138   1              right_motor_back; //ҵ  
 139   1      }
 140          
 141          
 142          /*PWMʹ Сת*/
 143          void left_run()
 144          {
 145   1              left_motor_stops; //ֹͣ
 146   1              right_motor_go; //ҵǰ    
 147   1      }
 148          
 149          
 150          /*PWMʹ Сת*/
 151          void right_run()
 152          {
 153   1              right_motor_stops;//ҵֹͣ
 154   1              left_motor_go;    //ǰ
 155   1      }
 156          
 157          
 158          /*Сֹͣ*/
 159          void stop()
 160          {
 161   1              right_motor_stops;//ҵֹͣ
 162   1              left_motor_stops; //ֹͣ  
 163   1      }
 164          
 165          void main()
 166          {
 167   1              init(); //ִгʼʱ0ⲿж0
 168   1              Left_moto_pwm = Right_moto_pwm = 1;//ʹҵ
 169   1              while(1)        //ѭ
 170   1              {
 171   2                      if(IRok)    //жǷ                    
 172   2                      {   
 173   3                              IRcordpro();//4ֽڵ
 174   3                              IRok = 0;       //µȴ
 175   3                              if(IRpro_ok) //жǷ  
 176   3                              {
 177   4                              switch(IRcord[2])
 178   4                                      {
C51 COMPILER V9.00   MAIN                                                                  12/22/2020 21:04:42 PAGE 4   

 179   5                                           case 0x18:  stop(); Delay_Ms(200); forward();                       //ǰ
 180   5                                                   break;
 181   5                                           case 0x52:  stop(); Delay_Ms(200); backward();                      //  
 182   5                                                   break;
 183   5                                           case 0x08:  stop(); Delay_Ms(200); left_run();                      //ת
 184   5                                                   break;
 185   5                                               case 0x5A:  stop(); Delay_Ms(200); right_run();                         //ת
 186   5                                                   break;
 187   5                                               case 0x1C:  stop();                         //ֹͣ
 188   5                                                   break;
 189   5                                               default:break;
 190   5                                      }
 191   4                                      IRpro_ok = 0;
 192   4                              }
 193   3                      }       
 194   2              }
 195   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    290    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     39    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
