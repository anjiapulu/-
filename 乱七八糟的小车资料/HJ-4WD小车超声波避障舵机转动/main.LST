C51 COMPILER V9.54   MAIN                                                                  05/20/2021 20:34:35 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND T
                    -ABS(2)

line level    source

   1          /*****************HJ-4WD-WIFIWIFIС*****************
   2          *  ƽ̨HJ-4WD/HJ-E/HL-1С + Keil U4 + STC89C52RC
   3          *  ƣ
   4          *  ˾۾ӿƼ޹˾
   5          *  Աhttp://shop37031453.taobao.com       
   6          *  վwww.hjmcu.com  СרվWWW.HLMCU.COM վwww.hjduino.com
   7          *  д۾
   8          *  ڣ2008-8-08
   9          *  :ܳQQ:1526248688  QQ:398115088  QQ:3309342008
  10          *  :11.0592MHZ
  11          *  ˵ѿԴṩԴֱӵ۾̳
  12          *  ̳http://www.hlmcu.com/bbs
  13          *  ѽԵ5Ǻ18ϰ׷ۺټϣ
  14          *  Ƶ̳̣СϸƵ̳̣Ҫ뵽۾վ
  15          ---ע۾΢Źں׵Ƶ̳---
  16          ******************************************************************/
  17          //ưñӷ 
  18          //J6-1 P1.0P1.7 IOڴñȫ
  19              // PWMСȫٶС
  20              // PWMJ21 PWM 4ñҪװϣJ20(IN)/J22(EN) 8ñװϣСȫٶ
             -  
  21            //עֻο֮ãҪﵽЧҪͬѧϸĵԡ  
  22            //עⳬߣ֮˾Ӵߣջģ飬һҪ˶Ժͨ飬ģӴջޣġ
             -
  23            /****************************************************************************
  24             Ӳ
  25             ߶壺
  26          
  27               ң GND
  28          
  29               ɫ VCC 4.8-5.2V
  30          
  31               Ȼߣ 
  32          
  33             Ѷ뵥ƬJ3ӿ  --עⲻҪӴߣջޣ
  34             öŰ߽ӵJ1
  35             Լװöг̶ܣСʱСĲҪײ壬׶Ϲ̶֧
  36            ****************************************************************************/
  37          
  38            #include <AT89x51.H>
  39            #include <HJ-4WD_PWM.H>
  40            #include <intrins.h>
  41            #include "18b20.h"
  42          
  43            #define Sevro_moto_pwm     P2_7    //ӶźŶPWMźŵٶ
  44          
  45            #define  ECHO  P2_4          //ӿڶ
  46            #define  TRIG  P2_5          //ӿڶ
  47          
  48            //HJ-4WDС߶
  49          
  50          
  51            unsigned char const discode[] ={ 0xC0,0xF9,0xA4,0xB0,0x99,0x92,0x82,0xF8,0x80,0x90,0xBF,0xff/*-*/};
  52            unsigned char const positon[3]={ 0xfe,0xfd,0xfb};
C51 COMPILER V9.54   MAIN                                                                  05/20/2021 20:34:35 PAGE 2   

  53            unsigned char disbuff[4]    ={ 0,0,0,0,};
  54            unsigned char posit=0;
  55            unsigned long S=0;
  56            unsigned long S1=0;
  57            unsigned long S2=0;
  58            unsigned long S3=0;
  59            unsigned long S4=0;
  60            unsigned int  timer=0;      //ʱ׼
  61            unsigned char timer1=0;     //ɨʱ          
  62          
  63            
  64          /************************************************************************/
  65              void Display(void)          //ɨ
  66            {
  67   1         if(posit==0)
  68   1         {P0=(discode[disbuff[posit]])&0x7f;}//
  69   1         else
  70   1         {P0=discode[disbuff[posit]];}
  71   1      
  72   1          if(posit==0)
  73   1         { P2_1=0;P2_2=1;P2_3=1;}
  74   1          if(posit==1)
  75   1          {P2_1=1;P2_2=0;P2_3=1;}
  76   1          if(posit==2)
  77   1          {P2_1=1;P2_2=1;P2_3=0;}
  78   1          if(++posit>=3)
  79   1          posit=0;
  80   1        }
  81          /************************************************************************/
  82               void  StartModule()          //ź
  83             {
  84   1          TRIG=1;                     
  85   1          _nop_(); 
  86   1          _nop_(); 
  87   1          _nop_(); 
  88   1          _nop_(); 
  89   1          _nop_(); 
  90   1          _nop_(); 
  91   1          _nop_(); 
  92   1          _nop_(); 
  93   1          _nop_(); 
  94   1          _nop_(); 
  95   1          _nop_(); 
  96   1          _nop_(); 
  97   1          _nop_(); 
  98   1          _nop_(); 
  99   1          _nop_(); 
 100   1          _nop_(); 
 101   1          _nop_();
 102   1          _nop_(); 
 103   1          _nop_(); 
 104   1          _nop_(); 
 105   1          _nop_();
 106   1          TRIG=0;
 107   1         }
 108           /***************************************************/
 109              void Conut(void)       //
 110            {
 111   1          while(!ECHO);          //RXΪʱȴ
 112   1          TR0=1;             //
 113   1          while(ECHO);         //RXΪ1ȴ
 114   1          TR0=0;           //رռ
C51 COMPILER V9.54   MAIN                                                                  05/20/2021 20:34:35 PAGE 3   

 115   1          time=TH0*256+TL0;      //ȡ
 116   1          TH0=0;
 117   1          TL0=0;
 118   1          S=(time*1.7)/100;        //CM
 119   1          disbuff[0]=S%1000/100;   //ʾ
 120   1          disbuff[1]=S%1000%100/10;
 121   1          disbuff[2]=S%1000%10 %10;
 122   1        }
 123          /************************************************************************/
 124          
 125          /************************************************************************/
 126           void  COMM( void )   //        
 127            {
 128   1               
 129   1           
 130   1            push_val_left=5;    //ת90
 131   1            timer=0;
 132   1            while(timer<=4000); //ʱ400MSöתλ    4000
 133   1            StartModule();    //
 134   1                Conut();        //
 135   1            S2=S;  
 136   1        
 137   1            push_val_left=23;   //ת90
 138   1            timer=0;
 139   1            while(timer<=4000); //ʱ400MSöתλ
 140   1            StartModule();    //
 141   1                Conut();        //
 142   1            S4=S;   
 143   1        
 144   1      
 145   1            push_val_left=14;   //
 146   1            timer=0;
 147   1            while(timer<=4000); //ʱ400MSöתλ
 148   1      
 149   1            StartModule();    //
 150   1                Conut();        //
 151   1            S1=S;   
 152   1      
 153   1                if((S2<20)||(S4<20)) //ֻҪҸоСڣ20CMС
 154   1            {
 155   2            backrun();       //
 156   2            timer=0;
 157   2            while(timer<=2000);
 158   2            }
 159   1             
 160   1            if(S2>S4)    
 161   1               {
 162   2              rightrun();   //߱ȳұ߾С  ת  
 163   2                  timer=0;
 164   2                  while(timer<=1500);
 165   2               }              
 166   1                 else
 167   1               {
 168   2                 leftrun();   //߱ȳұ߾  ת
 169   2                 timer=0;
 170   2                 while(timer<=1500);
 171   2               }
 172   1                     
 173   1      
 174   1      }
 175          
 176          /************************************************************************/
C51 COMPILER V9.54   MAIN                                                                  05/20/2021 20:34:35 PAGE 4   

 177          /*                    PWMƵת                                   */
 178          /************************************************************************/
 179          /*                                                            */
 180          /*push_val_leftֵıת,ռձ            */
 181              void pwm_Servomoto(void)
 182          {  
 183   1       
 184   1          if(pwm_val_left<=push_val_left)
 185   1               Sevro_moto_pwm=1; 
 186   1        else 
 187   1               Sevro_moto_pwm=0;
 188   1        if(pwm_val_left>=200)
 189   1        pwm_val_left=0;
 190   1       
 191   1      }
 192          /***************************************************/
 193          ///*TIMER1жϷӺPWMź*/
 194            void time1()interrupt 3   using 2
 195          { 
 196   1           TH1=(65536-100)/256;   //100USʱ
 197   1         TL1=(65536-100)%256;
 198   1         timer++;         //ʱ100USΪ׼ʱ
 199   1         pwm_val_left++;
 200   1         pwm_Servomoto();
 201   1      
 202   1         timer1++;         //2MSɨһ
 203   1         if(timer1>=20)
 204   1         {
 205   2         timer1=0;
 206   2         Display(); 
 207   2         }
 208   1       }
 209          /***************************************************/
 210          ///*TIMER0жϷӺPWMź*/
 211           /***************************************************/
 212          
 213            void main(void)
 214          {
 215   1        TMOD=0X11;
 216   1        TH1=(65536-100)/256;    //100USʱ
 217   1        TL1=(65536-100)%256;
 218   1        TH0=0XFc;
 219   1        TL0=0X18;  
 220   1        TR1= 1;
 221   1        ET1= 1;
 222   1        ET0= 1;
 223   1        EA = 1;
 224   1        delay(100);
 225   1        push_val_left=14;   //
 226   1      
 227   1      
 228   1        while(1)           /*ѭ*/
 229   1        { 
 230   2         while(Left_X_led==1&&Right_X_led==1)
 231   2         {
 232   3          run();
 233   3         }
 234   2      
 235   2        
 236   2            while(Right_X_led==0||Left_X_led==0)/*ѭ*/
 237   2         {
 238   3      
C51 COMPILER V9.54   MAIN                                                                  05/20/2021 20:34:35 PAGE 5   

 239   3              if (Left_X_led == 1 && Right_X_led == 0)
 240   3              {
 241   4                Left_moto_go;
 242   4                Right_moto_back;
 243   4                delay(50);
 244   4              }
 245   3              if (Right_X_led == 1 && Left_X_led == 0)
 246   3              {
 247   4      
 248   4                Right_moto_go;
 249   4                Left_moto_back;
 250   4                delay(50);
 251   4              }
 252   3              if(Right_X_led==0&&Left_X_led==0)
 253   3              {
 254   4            if(timer>=1000)   //100MSһ  1000
 255   4           {
 256   5               timer=0;
 257   5             StartModule(); //
 258   5                 Conut();     //
 259   5                 if(S<25)     //С25CM
 260   5             {
 261   6             stoprun();   //Сֹͣ
 262   6             COMM();      //
 263   6             }
 264   5             else
 265   5             if(S>30)     //ڣ30CMǰ
 266   5             run();
 267   5           }
 268   4         }
 269   3       }
 270   2         
 271   2        }
 272   1          
 273   1          
 274   1          
 275   1      }
 276          
 277            


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1151    ----
   CONSTANT SIZE    =     85    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     56    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      4    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
