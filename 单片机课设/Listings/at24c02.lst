C51 COMPILER V9.54   AT24C02                                                               05/02/2021 16:06:12 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE AT24C02
OBJECT MODULE PLACED IN .\Objects\at24c02.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE at24c02.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEN
                    -D PRINT(.\Listings\at24c02.lst) TABS(2) OBJECT(.\Objects\at24c02.obj)

line level    source

   1          #include <reg52.h>         
   2          #include <intrins.h>
   3          #include "delay.h"
   4          #define  _Nop()  _nop_()                                                
   5          sbit SDA=P2^1;          
   6          sbit SCL=P2^0;                  
   7          bit ack;               
   8          void Start_I2c()
   9          {
  10   1        SDA=1;  
  11   1        _Nop();
  12   1        SCL=1;
  13   1        _Nop();   
  14   1        _Nop();
  15   1        _Nop();
  16   1        _Nop();
  17   1        _Nop();    
  18   1        SDA=0;     
  19   1        _Nop();   
  20   1        _Nop();
  21   1        _Nop();
  22   1        _Nop();
  23   1        _Nop();       
  24   1        SCL=0;   
  25   1        _Nop();
  26   1        _Nop();
  27   1      }
  28          
  29          void Stop_I2c()
  30          {
  31   1        SDA=0;    
  32   1        _Nop();   
  33   1        SCL=1;    
  34   1        _Nop();
  35   1        _Nop();
  36   1        _Nop();
  37   1        _Nop();
  38   1        _Nop();
  39   1        SDA=1;   
  40   1        _Nop();
  41   1        _Nop();
  42   1        _Nop();
  43   1        _Nop();
  44   1      }
  45          
  46          
  47          void  SendByte(unsigned char c)
  48          {
  49   1       unsigned char BitCnt;
  50   1       
  51   1       for(BitCnt=0;BitCnt<8;BitCnt++) 
  52   1          {
  53   2           if((c<<BitCnt)&0x80)SDA=1;   
  54   2             else  SDA=0;                
C51 COMPILER V9.54   AT24C02                                                               05/02/2021 16:06:12 PAGE 2   

  55   2           _Nop();
  56   2           SCL=1;             
  57   2            _Nop(); 
  58   2            _Nop();          
  59   2            _Nop();
  60   2            _Nop();
  61   2            _Nop();         
  62   2           SCL=0; 
  63   2          }
  64   1          
  65   1          _Nop();
  66   1          _Nop();
  67   1          SDA=1;             
  68   1          _Nop();
  69   1          _Nop();   
  70   1          SCL=1;
  71   1          _Nop();
  72   1          _Nop();
  73   1          _Nop();
  74   1          if(SDA==1)ack=0;     
  75   1             else ack=1;        
  76   1          SCL=0;
  77   1          _Nop();
  78   1          _Nop();
  79   1      }
  80          
  81          unsigned char  RcvByte()
  82          {
  83   1        unsigned char retc;
  84   1        unsigned char BitCnt;
  85   1        
  86   1        retc=0; 
  87   1        SDA=1;             
  88   1        for(BitCnt=0;BitCnt<8;BitCnt++)
  89   1            {
  90   2              _Nop();           
  91   2              SCL=0;      
  92   2              _Nop();
  93   2              _Nop();      
  94   2              _Nop();
  95   2              _Nop();
  96   2              _Nop();
  97   2              SCL=1;       
  98   2              _Nop();
  99   2              _Nop();
 100   2              retc=retc<<1;
 101   2              if(SDA==1)retc=retc+1;
 102   2              _Nop();
 103   2              _Nop(); 
 104   2            }
 105   1        SCL=0;    
 106   1        _Nop();
 107   1        _Nop();
 108   1        return(retc);
 109   1      }
 110          
 111          void Ack_I2c(void)
 112          {
 113   1        
 114   1        SDA=0;     
 115   1        _Nop();
 116   1        _Nop();
C51 COMPILER V9.54   AT24C02                                                               05/02/2021 16:06:12 PAGE 3   

 117   1        _Nop();      
 118   1        SCL=1;
 119   1        _Nop();
 120   1        _Nop();           
 121   1        _Nop();
 122   1        _Nop();
 123   1        _Nop();  
 124   1        SCL=0;               
 125   1        _Nop();
 126   1        _Nop();    
 127   1      }
 128          
 129          void NoAck_I2c(void)
 130          {
 131   1        
 132   1        SDA=1;
 133   1        _Nop();
 134   1        _Nop();
 135   1        _Nop();      
 136   1        SCL=1;
 137   1        _Nop();
 138   1        _Nop();             
 139   1        _Nop();
 140   1        _Nop();
 141   1        _Nop();  
 142   1        SCL=0;                
 143   1        _Nop();
 144   1        _Nop();    
 145   1      }
 146          
 147          
 148          bit ISendStr(unsigned char sla,unsigned char suba,unsigned char *s,unsigned char no)
 149          {
 150   1         unsigned char i;
 151   1      
 152   1         Start_I2c();              
 153   1         SendByte(sla);            
 154   1           if(ack==0)return(0);
 155   1         SendByte(suba);          
 156   1           if(ack==0)return(0);
 157   1      
 158   1         for(i=0;i<no;i++)
 159   1          {   
 160   2           SendByte(*s);           
 161   2             if(ack==0)return(0);
 162   2           s++;
 163   2          } 
 164   1       Stop_I2c();                 
 165   1        return(1);
 166   1      }
 167          
 168          
 169          bit IRcvStr(unsigned char sla,unsigned char suba,unsigned char *s,unsigned char no)
 170          {
 171   1         unsigned char i;
 172   1      
 173   1         Start_I2c();               
 174   1         SendByte(sla);            
 175   1           if(ack==0)return(0);
 176   1         SendByte(suba);            
 177   1           if(ack==0)return(0);
 178   1      
C51 COMPILER V9.54   AT24C02                                                               05/02/2021 16:06:12 PAGE 4   

 179   1         Start_I2c();
 180   1         SendByte(sla+1);
 181   1            if(ack==0)return(0);
 182   1      
 183   1         for(i=0;i<no-1;i++)
 184   1          {   
 185   2           *s=RcvByte();              
 186   2            Ack_I2c();              
 187   2           s++;
 188   2          } 
 189   1         *s=RcvByte();
 190   1          NoAck_I2c();                 
 191   1         Stop_I2c();                   
 192   1        return(1);
 193   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    310    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      12
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
