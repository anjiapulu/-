C51 COMPILER V9.54   MAIN                                                                  05/08/2021 16:22:24 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\OBJ\main.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND P
                    -RINT(.\LIST\main.lst) TABS(2) OBJECT(.\OBJ\main.obj)

line level    source

   1          #include <reg52.h>
   2          #include <stdio.h>
   3          #include <math.h>
   4          #include "1602.h"
   5          #include "delay.h"
   6          #include "string.h"
   7          #include "MatrixKey.h"
   8          
   9          sbit TRIGL = P2 ^ 0;
  10          sbit ECHOL = P2 ^ 1;
  11          sbit TRIGB = P2 ^ 2;
  12          sbit ECHOB = P2 ^ 3;
  13          sbit TRIGR = P3 ^ 6;
  14          sbit ECHOR = P3 ^ 7;
  15          //unsigned char code setdistance[] = " L___ F___ R___ ", KeyNum = 10;
  16          //unsigned char code number[] = "0123456789";
  17          unsigned char DisTempData[7];
  18          float S,arr[9], temp;
  19          /*------------------------------------------------
  20                     0   
  21          ------------------------------------------------*/
  22          void TIM1init(void)
  23          {
  24   1      
  25   1      TMOD |= 0x10;
  26   1      TH1 = 0x00;
  27   1      TL1 = 0x00;
  28   1      ET1 = 1;
  29   1      EA = 1;
  30   1      }
  31          /*------------------------------------------------
  32                  主函数
  33          ------------------------------------------------*/
  34          main()
  35          {
  36   1      TIM1init();    
  37   1      LCD_Init();    
  38   1      while (1)
  39   1      {
  40   2        
  41   2        int i, j;
  42   2        /*------------------------------------------------
  43   2                右方
  44   2        ------------------------------------------------*/
  45   2        if (1)
  46   2        {
  47   3          /*one*/
  48   3          TRIGR = 1;      
  49   3          DelayUs2x(10);
  50   3          TRIGR = 0;
  51   3          while (!ECHOR); 
  52   3          TR1 = 1;
  53   3          while (ECHOR);  
  54   3          TR1 = 0;
C51 COMPILER V9.54   MAIN                                                                  05/08/2021 16:22:24 PAGE 2   

  55   3          S = TH1 * 256 + TL1;
  56   3          S = S / 58;       
  57   3          arr[0] = S;     
  58   3          TH1 = 0;
  59   3          TL1 = 0;           
  60   3            /*two*/
  61   3          TRIGR = 1;       
  62   3          DelayUs2x(10);
  63   3          TRIGR = 0;
  64   3          while (!ECHOR);     
  65   3          TR1 = 1;
  66   3          while (ECHOR);       
  67   3          TR1 = 0;
  68   3          S = TH1 * 256 + TL1;
  69   3          S = S / 58;      
  70   3          arr[1] = S;      
  71   3          TH1 = 0;
  72   3          TL1 = 0;       
  73   3            /*third*/
  74   3          TRIGR = 1;     
  75   3          DelayUs2x(10);
  76   3          TRIGR = 0;
  77   3          while (!ECHOR);    
  78   3          TR1 = 1;
  79   3          while (ECHOR);      
  80   3          TR1 = 0;
  81   3          S = TH1 * 256 + TL1;
  82   3          S = S / 58;      
  83   3          arr[2] = S;     
  84   3          TH1 = 0;
  85   3          TL1 = 0;       
  86   3            /*four*/
  87   3          TRIGR = 1;       
  88   3          DelayUs2x(10);
  89   3          TRIGR = 0;
  90   3          while (!ECHOR);   
  91   3          TR1 = 1;
  92   3          while (ECHOR);     
  93   3          TR1 = 0;
  94   3          S = TH1 * 256 + TL1;
  95   3          S = S / 58;     
  96   3          arr[3] = S;    
  97   3          TH1 = 0;
  98   3          TL1 = 0;         
  99   3            /*five*/
 100   3          TRIGR = 1;      
 101   3          DelayUs2x(10);
 102   3          TRIGR = 0;
 103   3          while (!ECHOR);    
 104   3          TR1 = 1;
 105   3          while (ECHOR);       
 106   3          TR1 = 0;
 107   3          S = TH1 * 256 + TL1;
 108   3          S = S / 58;      
 109   3          arr[4] = S;     
 110   3          TH1 = 0;
 111   3          TL1 = 0;       
 112   3            /*SIX*/
 113   3          TRIGR = 1;      
 114   3          DelayUs2x(10);
 115   3          TRIGR = 0;
 116   3          while (!ECHOR);     
C51 COMPILER V9.54   MAIN                                                                  05/08/2021 16:22:24 PAGE 3   

 117   3          TR1 = 1;
 118   3          while (ECHOR);     
 119   3          TR1 = 0;
 120   3          S = TH1 * 256 + TL1;
 121   3          S = S / 58;       //     58    ,  Y =(X *344)/2
 122   3          arr[5] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 123   3          TH1 = 0;
 124   3          TL1 = 0;           
 125   3          /*SEVEN*/
 126   3          TRIGR = 1;       
 127   3          DelayUs2x(10);
 128   3          TRIGR = 0;
 129   3          while (!ECHOR);  
 130   3          TR1 = 1;
 131   3          while (ECHOR);  
 132   3          TR1 = 0;
 133   3          S = TH1 * 256 + TL1;
 134   3          S = S / 58;       //     58    ,  Y =(X *344)/2
 135   3          arr[6] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 136   3          TH1 = 0;
 137   3          TL1 = 0;          
 138   3          /*EIGHT*/
 139   3          TRIGR = 1;       
 140   3          DelayUs2x(10);
 141   3          TRIGR = 0;
 142   3          while (!ECHOR);      
 143   3          TR1 = 1;
 144   3          while (ECHOR);       
 145   3          TR1 = 0;
 146   3          S = TH1 * 256 + TL1;
 147   3          S = S / 58;       //     58    ,  Y =(X *344)/2
 148   3          arr[7] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 149   3          TH1 = 0;
 150   3          TL1 = 0;           
 151   3          /*NINE*/
 152   3          TRIGR = 1;       
 153   3          DelayUs2x(10);
 154   3          TRIGR = 0;
 155   3          while (!ECHOR);      
 156   3          TR1 = 1;
 157   3          while (ECHOR);     
 158   3          TR1 = 0;
 159   3          S = TH1 * 256 + TL1;
 160   3          S = S / 58;       //     58    ,  Y =(X *344)/2
 161   3          arr[8] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 162   3          TH1 = 0;
 163   3          TL1 = 0;          
 164   3          /*TEN*/
 165   3              TRIGR = 1;       
 166   3          DelayUs2x(10);
 167   3          TRIGR = 0;
 168   3          while (!ECHOR);      
 169   3          TR1 = 1;
 170   3          while (ECHOR);    
 171   3          TR1 = 0;
 172   3          S = TH1 * 256 + TL1;
 173   3          S = S / 58;       //     58    ,  Y =(X *344)/2
 174   3          arr[9] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 175   3          TH1 = 0;
 176   3          TL1 = 0;           
 177   3          /*try*/
 178   3      
C51 COMPILER V9.54   MAIN                                                                  05/08/2021 16:22:24 PAGE 4   

 179   3          for (i = 0; i < 10 - 1; i++)
 180   3            for (j = 0; j < 10 - 1 - i; j++)
 181   3              if (arr[j] > arr[j + 1])
 182   3              {
 183   4                temp = arr[j];
 184   4                arr[j] = arr[j + 1];
 185   4                arr[j + 1] = temp;
 186   4              }
 187   3          /*try*/
 188   3          S = ((arr[2] + arr[3] + arr[4]+arr[5]+arr[6]+arr[7]) / 6)+0.50;
 189   3          sprintf(DisTempData, "R=%6.2f", S);  
 190   3          LCD_Write_String(0, 1, DisTempData);       
 191   3          DelayMs(500);
 192   3        }
 193   2        /*------------------------------------------------
 194   2                左方
 195   2        ------------------------------------------------*/
 196   2        if (1)
 197   2        {
 198   3          /*one*/
 199   3          TRIGL = 1;     
 200   3          DelayUs2x(10);
 201   3          TRIGL = 0;
 202   3          while (!ECHOL);     
 203   3          TR1 = 1;
 204   3          while (ECHOL);       
 205   3          TR1 = 0;
 206   3          S = TH1 * 256 + TL1; 
 207   3          S = S / 58;       //     58    ,  Y =(X *344)/2
 208   3          arr[0] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 209   3          TH1 = 0;
 210   3          TL1 = 0;          
 211   3            /*two*/
 212   3          TRIGL = 1;       
 213   3          DelayUs2x(10);
 214   3          TRIGL = 0;
 215   3          while (!ECHOL);     
 216   3          TR1 = 1;
 217   3          while (ECHOL);    
 218   3          TR1 = 0;
 219   3          S = TH1 * 256 + TL1;
 220   3          S = S / 58;       //     58    ,  Y =(X *344)/2
 221   3          arr[1] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 222   3          TH1 = 0;
 223   3          TL1 = 0;       
 224   3            /*third*/
 225   3          TRIGL = 1;       
 226   3          DelayUs2x(10);
 227   3          TRIGL = 0;
 228   3          while (!ECHOL); 
 229   3          TR1 = 1;
 230   3          while (ECHOL);   
 231   3          TR1 = 0;
 232   3          S = TH1 * 256 + TL1;
 233   3          S = S / 58;       
 234   3          arr[2] = S;     
 235   3          TH1 = 0;
 236   3          TL1 = 0;         
 237   3            /*four*/
 238   3          TRIGL = 1;       
 239   3          DelayUs2x(10);
 240   3          TRIGL = 0;
C51 COMPILER V9.54   MAIN                                                                  05/08/2021 16:22:24 PAGE 5   

 241   3          while (!ECHOL);  
 242   3          TR1 = 1;
 243   3          while (ECHOL);  
 244   3          TR1 = 0;
 245   3          S = TH1 * 256 + TL1;
 246   3          S = S / 58;       
 247   3          arr[3] = S;     
 248   3          TH1 = 0;
 249   3          TL1 = 0;        
 250   3            /*five*/
 251   3          TRIGL = 1;       
 252   3          DelayUs2x(10);
 253   3          TRIGL = 0;
 254   3          while (!ECHOL); 
 255   3          TR1 = 1;
 256   3          while (ECHOL);    
 257   3          TR1 = 0;
 258   3          S = TH1 * 256 + TL1;
 259   3          S = S / 58;      
 260   3          arr[4] = S;      
 261   3          TH1 = 0;
 262   3          TL1 = 0;            
 263   3          /*SIX*/
 264   3          TRIGL = 1;       
 265   3          DelayUs2x(10);
 266   3          TRIGL = 0;
 267   3          while (!ECHOL);     
 268   3          TR1 = 1;
 269   3          while (ECHOL);       
 270   3          TR1 = 0;
 271   3          S = TH1 * 256 + TL1; 
 272   3          S = S / 58;       //     58    ,  Y =(X *344)/2
 273   3          arr[5] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 274   3          TH1 = 0;
 275   3          TL1 = 0;             
 276   3          /*SEVEN*/
 277   3          TRIGL = 1;       
 278   3          DelayUs2x(10);
 279   3          TRIGL = 0;
 280   3          while (!ECHOL); 
 281   3          TR1 = 1;
 282   3          while (ECHOL);  
 283   3          TR1 = 0;
 284   3          S = TH1 * 256 + TL1;
 285   3          S = S / 58;      
 286   3          arr[6] = S;      
 287   3          TH1 = 0;
 288   3          TL1 = 0;        
 289   3          /*EIGHT*/
 290   3          TRIGL = 1;       
 291   3          DelayUs2x(10);
 292   3          TRIGL = 0;
 293   3          while (!ECHOL);
 294   3          TR1 = 1;
 295   3          while (ECHOL);  
 296   3          TR1 = 0;
 297   3          S = TH1 * 256 + TL1;
 298   3          S = S / 58;      
 299   3          arr[7] = S;      
 300   3          TH1 = 0;
 301   3          TL1 = 0;       
 302   3          /*NINE*/
C51 COMPILER V9.54   MAIN                                                                  05/08/2021 16:22:24 PAGE 6   

 303   3          TRIGL = 1;       
 304   3          DelayUs2x(10);
 305   3          TRIGL = 0;
 306   3          while (!ECHOL);
 307   3          TR1 = 1;
 308   3          while (ECHOL);  
 309   3          TR1 = 0;
 310   3          S = TH1 * 256 + TL1;
 311   3          S = S / 58;      
 312   3          arr[8] = S;      
 313   3          TH1 = 0;
 314   3          TL1 = 0;      
 315   3          /*TEN*/
 316   3              TRIGL = 1;       
 317   3          DelayUs2x(10);
 318   3          TRIGL = 0;
 319   3          while (!ECHOL); 
 320   3          TR1 = 1;
 321   3          while (ECHOL);  
 322   3          TR1 = 0;
 323   3          S = TH1 * 256 + TL1;
 324   3          S = S / 58;     
 325   3          arr[9] = S;      
 326   3          TH1 = 0;
 327   3          TL1 = 0;      
 328   3          /*try*/
 329   3          for (i = 0; i < 10 - 1; i++)
 330   3            for (j = 0; j < 10 - 1 - i; j++)
 331   3              if (arr[j] > arr[j + 1])
 332   3              {
 333   4                temp = arr[j];
 334   4                arr[j] = arr[j + 1];
 335   4                arr[j + 1] = temp;
 336   4              }
 337   3          /*try*/
 338   3          S = ((arr[2] + arr[3] + arr[4]+arr[5]+arr[6]+arr[7]) / 6)+0.20;
 339   3          sprintf(DisTempData, "L=%6.2f", S);
 340   3          LCD_Write_String(4, 0, DisTempData);    
 341   3          DelayMs(1000);
 342   3        }
 343   2        /*------------------------------------------------
 344   2                后方
 345   2        ------------------------------------------------*/
 346   2        if (1)
 347   2        {
 348   3          TRIGB = 1;     
 349   3          DelayUs2x(10);
 350   3          TRIGB = 0;
 351   3          while (!ECHOB);     
 352   3          TR1 = 1;
 353   3          while (ECHOB);     
 354   3          TR1 = 0;
 355   3          S = TH1 * 256 + TL1; 
 356   3          S = S / 58;       //     58    ,  Y =(X *344)/2
 357   3          arr[0] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 358   3          TH1 = 0;
 359   3          TL1 = 0;         
 360   3            /*two*/
 361   3          TRIGB = 1;      
 362   3          DelayUs2x(10);
 363   3          TRIGB = 0;
 364   3          while (!ECHOB);    
C51 COMPILER V9.54   MAIN                                                                  05/08/2021 16:22:24 PAGE 7   

 365   3          TR1 = 1;
 366   3          while (ECHOB);      
 367   3          TR1 = 0;
 368   3          S = TH1 * 256 + TL1;
 369   3          S = S / 58;       //     58    ,  Y =(X *344)/2
 370   3          arr[1] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 371   3          TH1 = 0;
 372   3          TL1 = 0;          
 373   3            /*third*/
 374   3          TRIGB = 1;      
 375   3          DelayUs2x(10);
 376   3          TRIGB = 0;
 377   3          while (!ECHOB);    
 378   3          TR1 = 1;
 379   3          while (ECHOB);      
 380   3          TR1 = 0;
 381   3          S = TH1 * 256 + TL1;
 382   3          S = S / 58;       //     58    ,  Y =(X *344)/2
 383   3          arr[2] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 384   3          TH1 = 0;
 385   3          TL1 = 0;            
 386   3            /*four*/
 387   3          TRIGB = 1;      
 388   3          DelayUs2x(10);
 389   3          TRIGB = 0;
 390   3          while (!ECHOB);      
 391   3          TR1 = 1;
 392   3          while (ECHOB);      
 393   3          TR1 = 0;
 394   3          S = TH1 * 256 + TL1;
 395   3          S = S / 58;       //     58    ,  Y =(X *344)/2
 396   3          arr[3] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 397   3          TH1 = 0;
 398   3          TL1 = 0;         
 399   3            /*five*/
 400   3          TRIGB = 1;       
 401   3          DelayUs2x(10);
 402   3          TRIGB = 0;
 403   3          while (!ECHOB);    
 404   3          TR1 = 1;
 405   3          while (ECHOB);  
 406   3          TR1 = 0;
 407   3          S = TH1 * 256 + TL1;
 408   3          S = S / 58;       //     58    ,  Y =(X *344)/2
 409   3          arr[4] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 410   3          TH1 = 0;
 411   3          TL1 = 0;          
 412   3              /*SIX*/
 413   3          TRIGB = 1;      
 414   3          DelayUs2x(10);
 415   3          TRIGB = 0;
 416   3          while (!ECHOB);    
 417   3          TR1 = 1;
 418   3          while (ECHOB);    
 419   3          TR1 = 0;
 420   3          S = TH1 * 256 + TL1;
 421   3          S = S / 58;       //     58    ,  Y =(X *344)/2
 422   3          arr[5] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 423   3          TH1 = 0;
 424   3          TL1 = 0;           
 425   3          /*SEVEN*/
 426   3          TRIGB = 1;       
C51 COMPILER V9.54   MAIN                                                                  05/08/2021 16:22:24 PAGE 8   

 427   3          DelayUs2x(10);
 428   3          TRIGB = 0;
 429   3          while (!ECHOB);      
 430   3          TR1 = 1;
 431   3          while (ECHOB);       
 432   3          TR1 = 0;
 433   3          S = TH1 * 256 + TL1;
 434   3          S = S / 58;       //     58    ,  Y =(X *344)/2
 435   3          arr[6] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 436   3          TH1 = 0;
 437   3          TL1 = 0;          
 438   3          /*EIGHT*/
 439   3          TRIGB = 1;       
 440   3          DelayUs2x(10);
 441   3          TRIGB = 0;
 442   3          while (!ECHOB);  
 443   3          TR1 = 1;
 444   3          while (ECHOB);     
 445   3          TR1 = 0;
 446   3          S = TH1 * 256 + TL1;
 447   3          S = S / 58;       //     58    ,  Y =(X *344)/2
 448   3          arr[7] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 449   3          TH1 = 0;
 450   3          TL1 = 0;           
 451   3          /*NINE*/
 452   3          TRIGB = 1;      
 453   3          DelayUs2x(10);
 454   3          TRIGB = 0;
 455   3          while (!ECHOB);     
 456   3          TR1 = 1;
 457   3          while (ECHOB);     
 458   3          TR1 = 0;
 459   3          S = TH1 * 256 + TL1; 
 460   3          S = S / 58;       //     58    ,  Y =(X *344)/2
 461   3          arr[8] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 462   3          TH1 = 0;
 463   3          TL1 = 0;         
 464   3          /*TEN*/
 465   3          TRIGB = 1;       
 466   3          DelayUs2x(10);
 467   3          TRIGB = 0;
 468   3          while (!ECHOB);      
 469   3          TR1 = 1;
 470   3          while (ECHOB);    
 471   3          TR1 = 0;
 472   3          S = TH1 * 256 + TL1;
 473   3          S = S / 58;       //     58    ,  Y =(X *344)/2
 474   3          arr[9] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 475   3          TH1 = 0;
 476   3          TL1 = 0;        
 477   3          /*try*/
 478   3          for (i = 0; i < 10 - 1; i++)
 479   3            for (j = 0; j < 10 - 1 - i; j++)
 480   3              if (arr[j] > arr[j + 1])
 481   3              {
 482   4                temp = arr[j];
 483   4                arr[j] = arr[j + 1];
 484   4                arr[j + 1] = temp;
 485   4              }
 486   3          /*try*/
 487   3          S = ((arr[2] + arr[3] + arr[4]+arr[5]+arr[6]+arr[7]) / 6)+0.30 ;
 488   3          sprintf(DisTempData, "B=%6.2f", S);
C51 COMPILER V9.54   MAIN                                                                  05/08/2021 16:22:24 PAGE 9   

 489   3          LCD_Write_String(8, 1, DisTempData);
 490   3      
 491   3        }
 492   2       }
 493   1      
 494   1      }
 495          /*------------------------------------------------
 496                     中断
 497          ------------------------------------------------*/
 498          void Timer0_isr(void) interrupt 2
 499          {
 500   1      ECHOL = 0;
 501   1      ECHOB = 0;
 502   1      ECHOR = 0;
 503   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   3181    ----
   CONSTANT SIZE    =     24    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     51       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
