C51 COMPILER V9.54   MAIN                                                                  05/14/2021 17:46:05 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\OBJ\main.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND P
                    -RINT(.\LIST\main.lst) TABS(2) OBJECT(.\OBJ\main.obj)

line level    source

   1          #include <reg52.h>
   2          #include <stdio.h>
   3          #include <math.h>
   4          #include "1602.h"
   5          #include "delay.h"
   6          #include "string.h"
   7          //#include "MatrixKey.h"
   8          #include <QX_A11.h>//QX-A51智能小车配置文件
   9          typedef unsigned int u16;
  10          typedef unsigned int u8;
  11          u8 timer1;
  12          
  13          
  14          unsigned char DisTempData[7];
  15          //unsigned char code studentid[]="0123456789";
  16          float S, arr[5], temp;
  17          float leftnumber, backnumber, rightnumber;
  18          int i, k=0, j, KeyNum = 10;
  19          /*------------------------------------------------
  20                     子函数
  21          ------------------------------------------------*/
  22          void pwm1(u16 count)
  23          {
  24   1       if(count>=timer1)
  25   1         IN1=1;
  26   1         else
  27   1         IN1=0;
  28   1      }
  29          void pwm2(u16 count)
  30          {
  31   1       if(count>=timer1)IN2=1;
  32   1         else
  33   1         IN2=0;
  34   1      }
  35          void pwm3(u16 count)
  36          {
  37   1       if(count>=timer1)IN3=1;
  38   1         else
  39   1         IN3=0;
  40   1      }
  41          void pwm4(u16 count)
  42          {
  43   1       if(count>=timer1)IN4=1;
  44   1         else
  45   1         IN4=0;
  46   1      }
  47          void Timer0Init()
  48          {
  49   1       TMOD|=0X01;
  50   1       TH0=(65536-100)/256;
  51   1       TL0=(65536-100)%256;
  52   1       ET0=1;
  53   1       EA=1;
  54   1       TR0=1;
C51 COMPILER V9.54   MAIN                                                                  05/14/2021 17:46:05 PAGE 2   

  55   1      }
  56          void Time0() interrupt 1
  57          {
  58   1       TH0=(65536-100)/256;
  59   1       TL0=(65536-100)%256;
  60   1       timer1++;
  61   1       if(timer1>100)
  62   1       {
  63   2        timer1=0;
  64   2       }
  65   1      }
  66          
  67          
  68          void TIM1init(void)
  69          {
  70   1      
  71   1        TMOD |= 0x10;
  72   1        TH1 = 0x00;
  73   1        TL1 = 0x00;
  74   1        ET1 = 1;
  75   1      }
  76          void Forward()
  77          {
  78   1       pwm1(3);
  79   1       IN2=0;
  80   1       Left_moto_pwm=1;
  81   1       IN3=0;
  82   1       pwm4(3);
  83   1       Right_moto_pwm=1;
  84   1      }
  85          void back()
  86          {
  87   1       IN1=0;
  88   1       pwm2(5);
  89   1       Left_moto_pwm=1;
  90   1       pwm3(5);
  91   1       IN4=0;
  92   1       Right_moto_pwm=1;
  93   1      }
  94          void turnright()
  95          {
  96   1       IN1=0;
  97   1       IN2=0;
  98   1       Left_moto_pwm=0;
  99   1       IN3=0;
 100   1       pwm4(3);
 101   1       Right_moto_pwm=1;
 102   1      }
 103          void turnleft()
 104          {
 105   1       pwm1(3);
 106   1       IN2=0;
 107   1       Left_moto_pwm=1;
 108   1       IN3=0;
 109   1       IN4=0;
 110   1       Right_moto_pwm=0;
 111   1      }
 112          void stop()
 113          {
 114   1       IN1=0;
 115   1       IN2=0;
 116   1       IN3=0;
C51 COMPILER V9.54   MAIN                                                                  05/14/2021 17:46:05 PAGE 3   

 117   1       IN4=0;
 118   1      }
 119          
 120          /*------------------------------------------------
 121                  主函数
 122          ------------------------------------------------*/
 123          main()
 124          {
 125   1        TIM1init();
 126   1        LCD_Init();
 127   1        Timer0Init();
 128   1        while (1)
 129   1        {
 130   2      /*------------------------------------------------
 131   2          蜂鸣器警戒值输入
 132   2          while (k <= 3)
 133   2          {
 134   2            if (k == 0)
 135   2            {
 136   2                LCD_Write_String(0, 1, " L___ B___ R___ ");
 137   2            }
 138   2            LCD_Write_String(0, 0, "   input dist   ");
 139   2            KeyNum = MatrixKey();
 140   2            if (KeyNum == 13)
 141   2            {
 142   2              k++;
 143   2              if (k == 1)
 144   2              {
 145   2                for (i = 2; i < 5;)
 146   2                {
 147   2                  KeyNum = MatrixKey();
 148   2                  if(i==2)
 149   2                  {
 150   2                  if(KeyNum>0&&KeyNum<10)
 151   2                  {
 152   2                  leftnumber+=(KeyNum*100);
 153   2                  }
 154   2                  }
 155   2                  if(i==3)
 156   2                  {
 157   2                  if(KeyNum>0&&KeyNum<10)
 158   2                  {
 159   2                  leftnumber+=(KeyNum*10);
 160   2                  }
 161   2                  }
 162   2                  if(i==4)
 163   2                  {
 164   2                  if(KeyNum>0&&KeyNum<10)
 165   2                  {
 166   2                  leftnumber+=(KeyNum);
 167   2                  }
 168   2                  }
 169   2                  if (KeyNum < 10)
 170   2                  {
 171   2                    
 172   2                    LCD_Write_Char(i, 1, studentid[KeyNum]);
 173   2                    i++;
 174   2                  }
 175   2                  DelayMs(50);
 176   2              
 177   2                }
 178   2              }
C51 COMPILER V9.54   MAIN                                                                  05/14/2021 17:46:05 PAGE 4   

 179   2              if (k == 2)
 180   2              {
 181   2                for (i = 7; i < 10; )
 182   2                {
 183   2                  KeyNum = MatrixKey();
 184   2                  if(i==7)
 185   2                  {
 186   2                  if(KeyNum>0&&KeyNum<10)
 187   2                  {
 188   2                  backnumber+=(KeyNum*100);
 189   2                  }
 190   2                  }
 191   2                  if(i==8)
 192   2                  {
 193   2                  if(KeyNum>0&&KeyNum<10)
 194   2                  {
 195   2                  backnumber+=(KeyNum*10);
 196   2                  }
 197   2                  }
 198   2                  if(i==9)
 199   2                  {
 200   2                  if(KeyNum>0&&KeyNum<10)
 201   2                  {
 202   2                  backnumber+=(KeyNum);
 203   2                  }
 204   2                  }
 205   2                  if (KeyNum < 10)
 206   2                  {
 207   2                    LCD_Write_Char(i, 1, studentid[KeyNum]);
 208   2                    i++;
 209   2                  }
 210   2                  DelayMs(50);
 211   2                }
 212   2              }
 213   2              if (k == 3)
 214   2              {
 215   2                k=4;
 216   2                for (i = 12; i < 15; )
 217   2                {
 218   2                  KeyNum = MatrixKey();
 219   2                  if(i==12)
 220   2                  {
 221   2                  if(KeyNum>0&&KeyNum<10)
 222   2                  {
 223   2                  rightnumber+=(KeyNum*100);
 224   2                  }
 225   2                  }
 226   2                  if(i==13)
 227   2                  {
 228   2                  if(KeyNum>0&&KeyNum<10)
 229   2                  {
 230   2                  rightnumber+=(KeyNum*10);
 231   2                  }
 232   2                  }
 233   2                  if(i==14)
 234   2                  {
 235   2                  if(KeyNum>0&&KeyNum<10)
 236   2                  {
 237   2                  rightnumber+=(KeyNum);
 238   2                  }
 239   2                  }
 240   2                  if (KeyNum < 10)
C51 COMPILER V9.54   MAIN                                                                  05/14/2021 17:46:05 PAGE 5   

 241   2                  {
 242   2                    LCD_Write_Char(i, 1, studentid[KeyNum]);
 243   2                    i++;
 244   2                  }
 245   2                  DelayMs(50);
 246   2                }
 247   2      
 248   2                LCD_Write_String(0, 0, "                ");
 249   2              }
 250   2            }
 251   2          }
 252   2        
 253   2          
 254   2      //  
 255   2      ------------------------------------------------*/
 256   2          /*------------------------------------------------
 257   2                  右方
 258   2          ------------------------------------------------*/
 259   2          if (1)
 260   2          {
 261   3            /*one*/
 262   3            TRIGR = 1;
 263   3            DelayUs2x(10);
 264   3            TRIGR = 0;
 265   3            while (!ECHOR);
 266   3            TR1 = 1;
 267   3            while (ECHOR);
 268   3            TR1 = 0;
 269   3            S = TH1 * 256 + TL1;
 270   3            S = S / 58;
 271   3            arr[0] = S;
 272   3            TH1 = 0;
 273   3            TL1 = 0;
 274   3            /*two*/
 275   3            TRIGR = 1;
 276   3            DelayUs2x(10);
 277   3            TRIGR = 0;
 278   3            while (!ECHOR);
 279   3            TR1 = 1;
 280   3            while (ECHOR);
 281   3            TR1 = 0;
 282   3            S = TH1 * 256 + TL1;
 283   3            S = S / 58;
 284   3            arr[1] = S;
 285   3            TH1 = 0;
 286   3            TL1 = 0;
 287   3            /*third*/
 288   3            TRIGR = 1;
 289   3            DelayUs2x(10);
 290   3            TRIGR = 0;
 291   3            while (!ECHOR);
 292   3            TR1 = 1;
 293   3            while (ECHOR);
 294   3            TR1 = 0;
 295   3            S = TH1 * 256 + TL1;
 296   3            S = S / 58;
 297   3            arr[2] = S;
 298   3            TH1 = 0;
 299   3            TL1 = 0;
 300   3            /*four*/
 301   3            TRIGR = 1;
 302   3            DelayUs2x(10);
C51 COMPILER V9.54   MAIN                                                                  05/14/2021 17:46:05 PAGE 6   

 303   3            TRIGR = 0;
 304   3            while (!ECHOR);
 305   3            TR1 = 1;
 306   3            while (ECHOR);
 307   3            TR1 = 0;
 308   3            S = TH1 * 256 + TL1;
 309   3            S = S / 58;
 310   3            arr[3] = S;
 311   3            TH1 = 0;
 312   3            TL1 = 0;
 313   3            /*five*/
 314   3            TRIGR = 1;
 315   3            DelayUs2x(10);
 316   3            TRIGR = 0;
 317   3            while (!ECHOR);
 318   3            TR1 = 1;
 319   3            while (ECHOR);
 320   3            TR1 = 0;
 321   3            S = TH1 * 256 + TL1;
 322   3            S = S / 58;
 323   3            arr[4] = S;
 324   3            TH1 = 0;
 325   3            TL1 = 0;
 326   3            /*try*/
 327   3            for (i = 0; i < 5 - 1; i++)
 328   3              for (j = 0; j < 5 - 1 - i; j++)
 329   3                if (arr[j] > arr[j + 1])
 330   3                {
 331   4                  temp = arr[j];
 332   4                  arr[j] = arr[j + 1];
 333   4                  arr[j + 1] = temp;
 334   4                }
 335   3            /*try*/
 336   3            S = ((arr[1] + arr[2] + arr[3] ) / 3);
 337   3      //      temp=rightnumber;
 338   3      //      if (S < temp)
 339   3      //      {
 340   3      //                                                  
 341   3      //      SPK = 0;//防止一直给喇叭通电造成损坏
 342   3      //      DelayMs(250);
 343   3      //        
 344   3      //      }
 345   3            
 346   3      //        SPK = 1;
 347   3            rightnumber=S;
 348   3            if(rightnumber<5.5||rightnumber>1000)
 349   3            {
 350   4            turnright();
 351   4            Forward();
 352   4            turnleft();
 353   4            back();
 354   4            }
 355   3            if(leftnumber>8)
 356   3            {
 357   4            turnright();
 358   4              stop();
 359   4            }
 360   3            sprintf(DisTempData, "R=%6.2f",S);
 361   3            LCD_Write_String(0, 1, DisTempData);
 362   3            DelayMs(500);
 363   3          }
 364   2          /*------------------------------------------------
C51 COMPILER V9.54   MAIN                                                                  05/14/2021 17:46:05 PAGE 7   

 365   2                左方
 366   2          ------------------------------------------------*/
 367   2          if (1)
 368   2          {
 369   3            /*one*/
 370   3            TRIGL = 1;
 371   3            DelayUs2x(10);
 372   3            TRIGL = 0;
 373   3            while (!ECHOL);
 374   3            TR1 = 1;
 375   3            while (ECHOL);
 376   3            TR1 = 0;
 377   3            S = TH1 * 256 + TL1;
 378   3            S = S / 58;       //     58    ,  Y =(X *344)/2
 379   3            arr[0] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 380   3            TH1 = 0;
 381   3            TL1 = 0;
 382   3            /*two*/
 383   3            TRIGL = 1;
 384   3            DelayUs2x(10);
 385   3            TRIGL = 0;
 386   3            while (!ECHOL);
 387   3            TR1 = 1;
 388   3            while (ECHOL);
 389   3            TR1 = 0;
 390   3            S = TH1 * 256 + TL1;
 391   3            S = S / 58;       //     58    ,  Y =(X *344)/2
 392   3            arr[1] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 393   3            TH1 = 0;
 394   3            TL1 = 0;
 395   3            /*third*/
 396   3            TRIGL = 1;
 397   3            DelayUs2x(10);
 398   3            TRIGL = 0;
 399   3            while (!ECHOL);
 400   3            TR1 = 1;
 401   3            while (ECHOL);
 402   3            TR1 = 0;
 403   3            S = TH1 * 256 + TL1;
 404   3            S = S / 58;
 405   3            arr[2] = S;
 406   3            TH1 = 0;
 407   3            TL1 = 0;
 408   3            /*four*/
 409   3            TRIGL = 1;
 410   3            DelayUs2x(10);
 411   3            TRIGL = 0;
 412   3            while (!ECHOL);
 413   3            TR1 = 1;
 414   3            while (ECHOL);
 415   3            TR1 = 0;
 416   3            S = TH1 * 256 + TL1;
 417   3            S = S / 58;
 418   3            arr[3] = S;
 419   3            TH1 = 0;
 420   3            TL1 = 0;
 421   3            /*five*/
 422   3            TRIGL = 1;
 423   3            DelayUs2x(10);
 424   3            TRIGL = 0;
 425   3            while (!ECHOL);
 426   3            TR1 = 1;
C51 COMPILER V9.54   MAIN                                                                  05/14/2021 17:46:05 PAGE 8   

 427   3            while (ECHOL);
 428   3            TR1 = 0;
 429   3            S = TH1 * 256 + TL1;
 430   3            S = S / 58;
 431   3            arr[4] = S;
 432   3            TH1 = 0;
 433   3            TL1 = 0;
 434   3      
 435   3            /*try*/
 436   3            for (i = 0; i < 5 - 1; i++)
 437   3              for (j = 0; j < 5 - 1 - i; j++)
 438   3                if (arr[j] > arr[j + 1])
 439   3                {
 440   4                  temp = arr[j];
 441   4                  arr[j] = arr[j + 1];
 442   4                  arr[j + 1] = temp;
 443   4                }
 444   3            /*try*/
 445   3            S = ((arr[1] + arr[2] + arr[3] ) / 3);
 446   3            leftnumber=S;
 447   3      //      if (S < temp)
 448   3      //      {
 449   3      //        
 450   3      //      SPK = 0;//防止一直给喇叭通电造成损坏
 451   3      //      DelayMs(250);
 452   3      //        
 453   3      //      }
 454   3      //      SPK = 1;
 455   3            if(leftnumber<5.5||leftnumber>1000)
 456   3            {
 457   4            turnleft();
 458   4            Forward();
 459   4            turnright();
 460   4            back();
 461   4            }
 462   3            if(rightnumber>8)
 463   3            {
 464   4            turnleft();
 465   4              stop();
 466   4            }
 467   3            sprintf(DisTempData,"L=%6.2f", S);
 468   3            LCD_Write_String(8, 1, DisTempData);
 469   3            DelayMs(500);
 470   3      
 471   3          }
 472   2          /*------------------------------------------------
 473   2                  后方
 474   2          ------------------------------------------------*/
 475   2          if (1)
 476   2            {
 477   3            TRIGB = 1;
 478   3            DelayUs2x(10);
 479   3            TRIGB = 0;
 480   3            while (!ECHOB);
 481   3            TR1 = 1;
 482   3            while (ECHOB);
 483   3            TR1 = 0;
 484   3            S = TH1 * 256 + TL1;
 485   3            S = S / 58;       //     58    ,  Y =(X *344)/2
 486   3            arr[0] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 487   3            TH1 = 0;
 488   3            TL1 = 0;
C51 COMPILER V9.54   MAIN                                                                  05/14/2021 17:46:05 PAGE 9   

 489   3            /*two*/
 490   3            TRIGB = 1;
 491   3            DelayUs2x(10);
 492   3            TRIGB = 0;
 493   3            while (!ECHOB);
 494   3            TR1 = 1;
 495   3            while (ECHOB);
 496   3            TR1 = 0;
 497   3            S = TH1 * 256 + TL1;
 498   3            S = S / 58;       //     58    ,  Y =(X *344)/2
 499   3            arr[1] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 500   3            TH1 = 0;
 501   3            TL1 = 0;
 502   3            /*third*/
 503   3            TRIGB = 1;
 504   3            DelayUs2x(10);
 505   3            TRIGB = 0;
 506   3            while (!ECHOB);
 507   3            TR1 = 1;
 508   3            while (ECHOB);
 509   3            TR1 = 0;
 510   3            S = TH1 * 256 + TL1;
 511   3            S = S / 58;       //     58    ,  Y =(X *344)/2
 512   3            arr[2] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 513   3            TH1 = 0;
 514   3            TL1 = 0;
 515   3            /*four*/
 516   3            TRIGB = 1;
 517   3            DelayUs2x(10);
 518   3            TRIGB = 0;
 519   3            while (!ECHOB);
 520   3            TR1 = 1;
 521   3            while (ECHOB);
 522   3            TR1 = 0;
 523   3            S = TH1 * 256 + TL1;
 524   3            S = S / 58;       //     58    ,  Y =(X *344)/2
 525   3            arr[3] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 526   3            TH1 = 0;
 527   3            TL1 = 0;
 528   3            /*five*/
 529   3            TRIGB = 1;
 530   3            DelayUs2x(10);
 531   3            TRIGB = 0;
 532   3            while (!ECHOB);
 533   3            TR1 = 1;
 534   3            while (ECHOB);
 535   3            TR1 = 0;
 536   3            S = TH1 * 256 + TL1;
 537   3            S = S / 58;       //     58    ,  Y =(X *344)/2
 538   3            arr[4] = S;      // X =( 2*Y )/344 -> X =0.0058*Y  ->   =  /58 
 539   3            TH1 = 0;
 540   3            TL1 = 0;
 541   3            /*try*/
 542   3            for (i = 0; i < 5 - 1; i++)
 543   3              for (j = 0; j < 5 - 1 - i; j++)
 544   3                if (arr[j] > arr[j + 1])
 545   3                {
 546   4                  temp = arr[j];
 547   4                  arr[j] = arr[j + 1];
 548   4                  arr[j + 1] = temp;
 549   4                }
 550   3            /*try*/
C51 COMPILER V9.54   MAIN                                                                  05/14/2021 17:46:05 PAGE 10  

 551   3            S = ((arr[1] + arr[2] + arr[3] ) / 3);
 552   3            backnumber=S;
 553   3      //      if (S < temp)
 554   3      //      {
 555   3      //        
 556   3      //      SPK = 0;//防止一直给喇叭通电造成损坏
 557   3      //      DelayMs(250);
 558   3      //        
 559   3      //      }
 560   3      //      SPK = 1;
 561   3      
 562   3           if(rightnumber>6&&leftnumber>6&&(backnumber>4&&backnumber<100))
 563   3           {
 564   4           back();
 565   4           }
 566   3      
 567   3           while(rightnumber<6&&leftnumber<6&&backnumber<4)
 568   3           {
 569   4           stop();
 570   4           }
 571   3           if(backnumber>1000)
 572   3           {
 573   4           Forward();
 574   4           }
 575   3          sprintf(DisTempData, "B=%6.2f", S);
 576   3          LCD_Write_String(4, 0, DisTempData);
 577   3          DelayMs(500);
 578   3          }
 579   2        }
 580   1        
 581   1      }
 582            
 583          
 584          
 585          /*------------------------------------------------
 586                   中断
 587          ------------------------------------------------*/
 588          void Timer0_isr(void) interrupt 2
 589          {
 590   1        ECHOL = 0;
 591   1        ECHOB = 0;
 592   1        ECHOR = 0;
 593   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2491    ----
   CONSTANT SIZE    =     24    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     57    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
