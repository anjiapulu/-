C51 COMPILER V9.54   MAIN                                                                  05/06/2021 16:46:53 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\OBJ\main.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND P
                    -RINT(.\LIST\main.lst) TABS(2) OBJECT(.\OBJ\main.obj)

line level    source

   1          
   2           #include <reg52.h>
   3           #include <stdio.h>
   4           #include <math.h>
   5           #include "1602.h"
   6           #include "delay.h"
   7          
   8           sbit TRIGL = P1^0 ;
   9           sbit ECHOL = P1^1 ;
  10           sbit TRIGF = P1^2 ;
  11           sbit ECHOF = P1^3 ;
  12           sbit TRIGR = P1^4 ;
  13           sbit ECHOR = P1^5 ;
  14           unsigned char DisTempData[16];
  15          
  16          /*------------------------------------------------
  17                              定时器0初始化
  18          ------------------------------------------------*/
  19          void TIM0init(void)
  20          {
  21   1      
  22   1        TMOD|= 0x01;//定时器0工作方式1
  23   1        TH0=0x00;    
  24   1        TL0=0x00; 
  25   1        ET0=1;
  26   1        EA=1;
  27   1      }
  28          /*------------------------------------------------
  29                              主函数
  30          ------------------------------------------------*/
  31          main()
  32          {
  33   1        float S;       //距离变量
  34   1        TIM0init();    //初始化定时器0
  35   1        LCD_Init();    //初始化LCD
  36   1        while(1)
  37   1        {
  38   2         /*left*/
  39   2         TRIGL=1;       //触发信号是高电平脉冲，宽度大于10us
  40   2         DelayUs2x(10);
  41   2         TRIGL=0;
  42   2         while(!ECHOL); //等待高电平
  43   2         TR0=1;
  44   2         while(ECHOL);  //等待低电平
  45   2         TR0=0;
  46   2         S=TH0*256+TL0;//取出定时器值高8位和低8位合并
  47   2         S=S/58;       //为什么除以58等于厘米，  Y米=（X秒*344）/2
  48   2                 // X秒=（ 2*Y米）/344 -> X秒=0.0058*Y米 -> 厘米=微秒/58 
  49   2         TH0=0;
  50   2         TL0=0;        //清除定时器0寄存器中的值
  51   2         sprintf(DisTempData,"L=%6.2f CM     ",S);//打印输出结果
  52   2         LCD_Write_String(0,0,DisTempData);       //在液晶屏上显示
  53   2         DelayMs(250);                            //延时决定采样速度
  54   2         /*front*/
C51 COMPILER V9.54   MAIN                                                                  05/06/2021 16:46:53 PAGE 2   

  55   2         TRIGF=1;       //触发信号是高电平脉冲，宽度大于10us
  56   2         DelayUs2x(10);
  57   2         TRIGF=0;
  58   2         while(!ECHOF); //等待高电平
  59   2         TR0=1;
  60   2         while(ECHOF);  //等待低电平
  61   2         TR0=0;
  62   2         S=TH0*256+TL0;//取出定时器值高8位和低8位合并
  63   2         S=S/58;       //为什么除以58等于厘米，  Y米=（X秒*344）/2
  64   2                 // X秒=（ 2*Y米）/344 -> X秒=0.0058*Y米 -> 厘米=微秒/58 
  65   2         TH0=0;
  66   2         TL0=0;        //清除定时器0寄存器中的值
  67   2         sprintf(DisTempData,"F=%6.2f CM     ",S);//打印输出结果
  68   2         LCD_Write_String(0,1,DisTempData);       //在液晶屏上显示
  69   2         DelayMs(2500);   
  70   2         /*RIGHT*/
  71   2         TRIGR=1;       //触发信号是高电平脉冲，宽度大于10us
  72   2         DelayUs2x(10);
  73   2         TRIGR=0;
  74   2         while(!ECHOR); //等待高电平
  75   2         TR0=1;
  76   2         while(ECHOR);  //等待低电平
  77   2         TR0=0;
  78   2         S=TH0*256+TL0;//取出定时器值高8位和低8位合并
  79   2         S=S/58;       //为什么除以58等于厘米，  Y米=（X秒*344）/2
  80   2                 // X秒=（ 2*Y米）/344 -> X秒=0.0058*Y米 -> 厘米=微秒/58 
  81   2         TH0=0;
  82   2         TL0=0;        //清除定时器0寄存器中的值
  83   2         sprintf(DisTempData,"R=%6.2f CM     ",S);//打印输出结果
  84   2         LCD_Write_String(0,1,DisTempData);       //在液晶屏上显示
  85   2         DelayMs(2500);   
  86   2        }
  87   1       }
  88          
  89          /*------------------------------------------------
  90                           定时器中断子程序
  91          ------------------------------------------------*/
  92          void Timer0_isr(void) interrupt 1
  93          {
  94   1       ECHOL=0;
  95   1        ECHOF=0;
  96   1         ECHOR=0;
  97   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    373    ----
   CONSTANT SIZE    =     48    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     16       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
